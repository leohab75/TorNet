#!/bin/bash

icon="/usr/local/bin/TorNet/source/icons/TorNet.png"

zenity --window-icon="$icon" --question --text="–£–¥–∞–ª–∏—Ç—å TorNet' —Å –ü–ö ?? " --width=300 --height=100

if [[ $? = "0" ]]; then

    rm -f "HOME"/'–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª'/TorNet
    rf -f "$HOME"/.config/autostart/TorNet.desktop 2>/dev/null

    while true; do

        dns_servers_chois=$(zenity --window-icon="$icon" --title="Delete options" --text="–ö–∞–∫–æ–π DNS resoler –æ—Å—Ç–∞–≤–∏—Ç—å ?" --list --radiolist \
            --column="üîÜ" --column="key" --column="–û–ø–∏—Å–∞–Ω–∏–µ" --hide-column=2 TRUE cloudflared_dns "–û—Å—Ç–∞–≤–∏—Ç—å Clouflared DoH client => 127.0.0.1:53" \
            FALSE systemd_dns "–í–∫–ª—é—á–∏—Ç—å   Systemd-resolver => 127.0.0.53:53" \
            FALSE users_dns "–£–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ DNS –°–µ—Ä–≤–µ—Ä–∞ => resolv.conf" --height=300 --width=400)

        if [[ $? = "0" ]]; then

            case $dns_servers_chois in

            cloudflared_dns)
                pkexec bash /usr/local/bin/TorNet/scripts/other/delete.sh "cloudflared"
                break
                ;;
            systemd_dns)
                pkexec bash /usr/local/bin/TorNet/scripts/other/delete.sh "systemd"
                break
                ;;
            users_dns)

                users_dns=$(zenity --window-icon="$icon" --entry --text="–£–∫–∞–∂–∏—Ç–µ DNS —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é" --entry-text="8.8.8.8, 1.1.1.1, 9.9.9.9")
                if [[ "$users_dns" != "" ]]; then

                    echo $users_dns | tee /usr/local/bin/TorNet/users_dns
                    sed -i 's/ //g;s/,/\n/g;' /usr/local/bin/TorNet/users_dns

                    if grep -q "[0-9]" /usr/local/bin/TorNet/users_dns; then

                        pkexec bash /usr/local/bin/TorNet/scripts/other/delete.sh "users"
                    else
                        zenity --window-icon="$icon" --error --text="–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å  –¶–∏—Ñ—Ä—ã ‚òπ "

                    fi
                else
                    zenity --window-icon="$icon" --error --text="–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ ‚òπ "

                fi
                ;;

            esac

        else
            break
        fi
    done
fi
#finish
exit 0
